# LCARS 自动诊断报告 (Auto-Diagnostic Report)

> [!IMPORTANT]
> 本文件由 ADS (Auto-Diagnostic Routine) 自动维护。请参考诊断结论进行修复。

## 活跃故障 (Active Faults)
### ERR-0x0519 | SendQueue.QQSender
- **发生时间**: 2026-01-30 18:56:36
- **错误信息**: `NO_GROUP_ID_IN_META`
- **原始指令**: `滴滴滴`
- **AI 诊断**: SendQueue.QQSender 在发送消息时，meta 数据中缺少 group_id 导致发送失败。
- **建议方案**:

```diff
```diff
--- a/app/services/bot/app/sender_qq.py
+++ b/app/services/bot/app/sender_qq.py
@@ -21,6 +21,9 @@
     async def send(self, text: str, meta: dict, msg_id: str, mod_info: dict):
         """Send message to QQ group or user."""
         logger.info(f"Sending message: {text=}, {meta=}")
+        if 'group_id' not in meta:
+            logger.error(f"Missing group_id in meta: {meta=}")
+            raise RuntimeError("NO_GROUP_ID_IN_META")
         # TODO: Implement QQ message sending logic here
         # For now, just log the message
         logger.info(f"[QQ] Sending: {text} to {meta}")
```
```

---
### ERR-0xE2E7 | SendQueue.QQSender
- **发生时间**: 2026-01-30 18:57:24
- **错误信息**: `NO_GROUP_ID_IN_META`
- **原始指令**: `滴滴滴`
- **AI 诊断**: SendQueue.QQSender 在发送消息时，meta 数据中缺少 group_id，导致发送失败。
- **建议方案**:

```diff
```diff
--- a/app/services/bot/app/send_queue.py
+++ b/app/services/bot/app/send_queue.py
@@ -146,6 +146,9 @@
         text_to_send = item.text
         mod_info = item.mod_info
         try:
+            if 'group_id' not in item.meta:
+                logger.error(f"Missing group_id in meta: {item.meta}")
+                raise RuntimeError("NO_GROUP_ID_IN_META")
             await self.sender.send(text_to_send, item.meta, item.id, mod_info)
             self.send_task_done(item.id, True)
         except Exception as e:
```
```

---
### ERR-0x35DA | Dispatcher.AgenticLoop
- **发生时间**: 2026-01-31 01:15:37
- **错误信息**: `locate_user() missing 1 required positional argument: 'target_mention'`
- **原始指令**: `计算机，请计算，2466年一月三一日上午九点十五分的星历是多少`
- **AI 诊断**: The `locate_user()` function is being called without the required `target_mention` argument. Additionally, it's receiving an unexpected `year` argument. This suggests a mismatch between the arguments being passed to `locate_user()` and the function's expected signature. The error originates from the dispatcher attempting to execute a tool with incorrect arguments.
- **建议方案**:

```diff
```diff
--- a/app/dispatcher.py
+++ b/app/dispatcher.py
@@ -1046,12 +1046,18 @@
     except Exception as e2:
         try:
             # Attempt to filter arguments based on the function's signature
+            import inspect
             sig = inspect.signature(func)
             filtered_args = {}
             for param in sig.parameters.values():
                 if param.name in args:
                     filtered_args[param.name] = args[param.name]
-            result = func(**filtered_args)
+            try:
+                result = func(**filtered_args)
+            except TypeError as e3:
+                logging.error(f"Error calling function {func.__name__} with filtered args: {filtered_args}. Original args: {args}. Exception: {e3}")
+                raise e3 # Re-raise the exception after logging
         except Exception as e:
             logging.error(f"Error during tool execution: {e}")
             raise e2
@@ -1232,6 +1238,10 @@
     try:
         tool_result = await _execute_tool(tool, args, event, user_profile, session_id)
     except Exception as e:
+        logging.error(f"Error executing tool {tool}: {e}")
+        # Log the arguments passed to the tool for debugging
+        logging.error(f"Arguments passed to tool: {args}")
+
         tool_result = None
         # Handle the exception (e.g., log it, return an error message to the user)
         # Consider re-raising the exception if it's unrecoverable
```
```

---


*Generated by LCARS Engineering Subroutine (Version 2.0)*
